---
import { getAuth } from "firebase-admin/auth";
import { app } from "../firebase/server";
import DashboardLayout from '../layouts/DashboardLayout.astro';

const auth = getAuth(app);

/* Check current session */
if (!Astro.cookies.has("session")) {
  return Astro.redirect("/signin");
}
const session = Astro.cookies.get("session");
if (!session) {

  console.log("No session found");
  return Astro.redirect("/signin");
}
const decodedCookie = await auth.verifySessionCookie(session.value);
const user = await auth.getUser(decodedCookie.uid);

if (!user) {
  console.log("No user found");
  return Astro.redirect("/signin");
}


---

<DashboardLayout>
  <div class="profile-card">
    <div class="profile-card__header">
      <div class="profile-card__avatar">
        <img src={user.photoURL} alt="Profile Picture" />
      </div>
      <div class="profile-card__info">
        <h1>{user.displayName}</h1>
        <p>{user.email}</p>
      </div>
    </div>
    <div class="profile-card__body">
      <h2>Profile</h2>
      <p>Here you can see your profile information</p>
    </div>
  </div>
  
</DashboardLayout>

<style lang="scss">
  .profile-card {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    background-color: white;
  }

  .profile-card__header {
    display: flex;
    gap: 1rem;
  }

  .profile-card__avatar {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    overflow: hidden;
    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .profile-card__info {
    display: flex;
    flex-direction: column;
    justify-content: center;
    h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    p {
      margin: 0;
      color: #666;
    }
  }

  .profile-card__body {
    h2 {
      font-size: 1.25rem;
      margin: 0;
    }
  }

</style>